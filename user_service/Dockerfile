FROM python:3.11-buster

RUN pip install poetry

COPY poetry.lock pyproject.toml ./

ARG POSTGRES_HOST
ARG POSTGRES_PORT
ARG POSTGRES_USERNAME
ARG POSTGRES_PASSWORD
ARG POSTGRESQL_USER_DATABASE

ENV POSTGRES_HOST = $POSTGRES_HOST
ENV POSTGRES_PORT = $POSTGRES_PORT
ENV POSTGRES_USERNAME = $POSTGRES_USERNAME
ENV POSTGRES_PASSWORD = $POSTGRES_PASSWORD
ENV POSTGRESQL_DATABASE = $POSTGRESQL_USER_DATABASE


RUN poetry install

# RUN poetry run alembic upgrade head

COPY . .

CMD ["poetry", "run", "uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
